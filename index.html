<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Vendas</title>
    <!-- jQuery primeiro -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    
    <!-- Bootstrap CSS e JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>
    
    <!-- Multiselect CSS e JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.2/css/bootstrap-multiselect.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.2/js/bootstrap-multiselect.js"></script>
    
    <!-- Outros scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css">
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <link rel="stylesheet" href="style.css">
    
    <!-- Multiselect CSS e JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.2/css/bootstrap-multiselect.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/1.1.2/js/bootstrap-multiselect.js"></script>
    
    <!-- Outros scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css">
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
<link rel="stylesheet" href="style.css">
<style>
    #company-logo {
        height: 70px; /* Ajuste a altura do logo aqui */
        width: auto;
    }
</style>

</head>
<body>
    <div id="login-overlay" class="login-overlay">
        <div id="login-box" class="login-box">
            <img src="logo_viva.png" alt="Logo Viva Eventos" id="login-logo" class="login-logo">
            <h2>Digite o Código de Acesso</h2>
            <input type="password" inputmode="numeric" pattern="[0-9]*" id="access-code-input" class="form-control" value="20250">
            <button id="access-code-button" class="btn btn-warning btn-block">Liberar Acesso</button>
            <p id="login-error-message"></p>
        </div>
    </div>

    <div class="dashboard-wrapper" style="display: none;">
        <!-- Botão do menu lateral corrigido -->
        <button id="sidebar-toggle"><span class="arrow-icon"></span></button>
        
        <div id="sidebar">
            <div class="page-navigation">
                <a href="https://central-dashs-viva-html.vercel.app/" class="page-navigation-button" id="return-to-hub-link"><button>Central de Dashboards VIVA Eventos</button></a>
                <hr>
                <button id="btn-page1" class="active" data-page="page1">Metas e Resultados</button>
                <button id="btn-page2" data-page="page2">Indicadores Secundários</button>
            </div>

            <section id="loader" class="filters">
                <div class="loader-container">
                    <div class="css-loader">
                        <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
                    </div>
                    <div class="loader-text">Carregando dados...</div>
                </div>
            </section>

            <section class="filters" id="filters-section" style="display: none;">
                <div class="filter-item filter-item-unidades"><select id="unidade-filter" multiple="multiple"></select></div>
                <div class="filter-item" id="curso-filter-container"><select id="curso-filter" multiple="multiple"></select></div>
                <div class="filter-item"><input type="date" id="start-date"></div>
                <div class="filter-item"><input type="date" id="end-date"></div>
            </section>
        </div>
        <div id="main-content">
            <div class="container">
                <header class="header">
                    <div>
                        <h1>Dashboard de Vendas e Metas</h1>
                        <span id="last-update-message"></span>
                    </div>
                    <img id="company-logo" src="logo_viva.png" alt="Logo da Empresa">
                </header>
                <div id="page1" class="page-content active">
                    <section class="kpi-container" id="kpi-section" style="display: none;">
                        <div class="kpi-main-wrapper">
                            <div class="kpi-main-cards-container">
                                <div class="kpi-main-card">
                                    <span class="kpi-card-title">REALIZADO TOTAL</span>
                                    <span class="kpi-card-value" id="kpi-total-realizado">R$ 0,00</span>
                                    <span class="kpi-card-details"><span class="percent" id="kpi-total-percent">0,0%</span> de <span id="kpi-total-meta">R$ 0,00</span> META TOTAL</span>
                                    <div class="progress-bar-bg"><div class="progress-bar-fg" id="kpi-total-progress"></div></div>
                                </div>
                                <div class="kpi-main-card">
                                    <span class="kpi-card-title">REALIZADO VENDAS</span>
                                    <span class="kpi-card-value" id="kpi-vendas-realizado">R$ 0,00</span>
                                    <span class="kpi-card-details"><span class="percent" id="kpi-vendas-percent">0,0%</span> de <span id="kpi-vendas-meta">R$ 0,00</span> META VENDAS</span>
                                    <div class="progress-bar-bg"><div class="progress-bar-fg" id="kpi-vendas-progress"></div></div>
                                </div>
                                <div class="kpi-main-card">
                                    <span class="kpi-card-title">REALIZADO PÓS VENDAS</span>
                                    <span class="kpi-card-value" id="kpi-posvendas-realizado">R$ 0,00</span>
                                    <span class="kpi-card-details"><span class="percent" id="kpi-posvendas-percent">0,0%</span> de <span id="kpi-posvendas-meta">R$ 0,00</span> META PÓS VENDAS</span>
                                    <div class="progress-bar-bg"><div class="progress-bar-fg" id="kpi-posvendas-progress"></div></div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section class="kpi-container" id="kpi-section-py" style="display: none;">
                        <h2 style="grid-column: span 12; font-size: 1.2em; border-bottom: none; padding-bottom: 0;">Desempenho no Período Anterior</h2>
                        <div class="kpi-main-wrapper" style="width: 100%; grid-column: span 12;">
                            <div class="kpi-main-cards-container">
                                <div class="kpi-main-card">
                                    <span class="kpi-card-title">REALIZADO TOTAL</span>
                                    <span class="kpi-card-value" id="kpi-total-realizado-py">R$ 0,00</span>
                                    <span class="kpi-card-details"><span class="percent" id="kpi-total-percent-py">0,0%</span> de <span id="kpi-total-meta-py">R$ 0,00</span> META TOTAL</span>
                                    <div class="progress-bar-bg"><div class="progress-bar-fg" id="kpi-total-progress-py"></div></div>
                                </div>
                                <div class="kpi-main-card">
                                    <span class="kpi-card-title">REALIZADO VENDAS</span>
                                    <span class="kpi-card-value" id="kpi-vendas-realizado-py">R$ 0,00</span>
                                    <span class="kpi-card-details"><span class="percent" id="kpi-vendas-percent-py">0,0%</span> de <span id="kpi-vendas-meta-py">R$ 0,00</span> META VENDAS</span>
                                    <div class="progress-bar-bg"><div class="progress-bar-fg" id="kpi-vendas-progress-py"></div></div>
                                </div>
                                <div class="kpi-main-card">
                                    <span class="kpi-card-title">REALIZADO PÓS VENDAS</span>
                                    <span class="kpi-card-value" id="kpi-posvendas-realizado-py">R$ 0,00</span>
                                    <span class="kpi-card-details"><span class="percent" id="kpi-posvendas-percent-py">0,0%</span> de <span id="kpi-posvendas-meta-py">R$ 0,00</span> META PÓS VENDAS</span>
                                    <div class="progress-bar-bg"><div class="progress-bar-fg" id="kpi-posvendas-progress-py"></div></div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section class="chart-container" id="chart-vvr-mes-section" style="display: none;">
                        <h2>VVR Realizado vs. Meta por Mês (Ano Vigente)</h2>
                        <div class="chart-selector">
                            <button id="btn-total" class="active" data-type="total">Total</button>
                            <button id="btn-vendas" data-type="vendas">Vendas</button>
                            <button id="btn-posvendas" data-type="posvendas">Pós Venda</button>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="vvrVsMetaPorMesChart"></canvas>
                        </div>
                    </section>
                    <section class="chart-container" id="chart-cumulative-section" style="display: none;">
                        <h2>VVR Acumulado Anual (Comparativo)</h2>
                        <div class="chart-selector" id="cumulative-chart-selector"></div>
                        <div class="chart-wrapper">
                            <canvas id="cumulativeVvrChart"></canvas>
                        </div>
                    </section>
                    <section class="table-container" id="table-section" style="display: none;">
                        <h2>Dados Detalhados por Mês/Unidade (Período Selecionado)</h2>
                        <div class="chart-selector">
                            <button class="active" data-type="total">Total</button>
                            <button data-type="vendas">Vendas</button>
                            <button data-type="posvendas">Pós Venda</button>
                        </div>
                        <table id="dados-table" class="display" style="width:100%">
                            <thead><tr><th>Unidade</th><th>Período</th><th>VVR Realizado</th><th>Meta VVR</th><th>Atingimento VVR</th></tr></thead>
                            <tbody></tbody>
                            <tfoot></tfoot>
                        </table>
                    </section>
                </div>
                <div id="page2" class="page-content">
                    <section class="chart-container" id="chart-monthly-vvr-section" style="display: none;">
                        <h2>Comparativo de VVR Mensal</h2>
                        <div class="chart-selector" id="monthly-chart-selector"></div>
                        <div class="chart-wrapper">
                           <canvas id="monthlyVvrChart"></canvas>
                        </div>
                    </section>
                    <div class="chart-row-adesoes">
                        <div class="chart-container" id="chart-yearly-stacked-section" style="display: none;">
                            <h2>Venda Realizada Total Anual</h2>
                            <div class="chart-wrapper">
                                <canvas id="yearlyStackedChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container" id="chart-monthly-stacked-section" style="display: none;">
                            <h2 id="monthly-stacked-title">Venda Realizada Total Mensal</h2>
                            <div class="chart-wrapper">
                                <canvas id="monthlyStackedChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row-adesoes">
                        <div class="chart-container" id="chart-yearly-ticket-section" style="display: none;">
                            <h2>Ticket Médio Anual</h2>
                            <div class="chart-wrapper">
                                <canvas id="yearlyTicketChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container" id="chart-monthly-ticket-section" style="display: none;">
                            <h2 id="monthly-ticket-title">Ticket Médio Mensal</h2>
                            <div class="chart-wrapper">
                                <canvas id="monthlyTicketChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="chart-row-adesoes">
                        <div class="chart-container" id="chart-yearly-contracts-section" style="display: none;">
                            <h2>Contratos Realizados Total Anual</h2>
                            <div class="chart-wrapper">
                                <canvas id="yearlyContractsChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container" id="chart-monthly-contracts-section" style="display: none;">
                            <h2 id="monthly-contracts-title">Contratos Realizados Total Mensal</h2>
                            <div class="chart-wrapper">
                                <canvas id="monthlyContractsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <section class="chart-container" id="chart-monthly-adesoes-section" style="display: block;">
                        <h2>Comparativo Mensal de Adesões</h2>
                        <div class="chart-selector" id="adesoes-chart-selector"></div>
                        <div class="chart-wrapper">
                           <canvas id="monthlyAdesoesChart"></canvas>
                        </div>
                    </section>
                    <div class="chart-row-adesoes">
                        <div class="chart-container" id="chart-yearly-adesoes-stacked-section" style="display: none;">
                            <h2>Adesões por Tipo (Anual)</h2>
                            <div class="chart-wrapper">
                                <canvas id="yearlyAdesoesStackedChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container" id="chart-monthly-adesoes-stacked-section" style="display: none;">
                            <h2 id="monthly-adesoes-stacked-title">Adesões por Tipo (Mensal)</h2>
                            <div class="chart-wrapper">
                                <canvas id="monthlyAdesoesStackedChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <section class="table-container" id="consultor-table-section" style="display: none;">
                        <h2>Desempenho por Consultor Comercial</h2>
                        <table id="consultor-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Unidade</th>
                                    <th>Consultor Comercial</th>
                                    <th>VVR Total</th>
                                    <th>Total de Adesões</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>
                    <section class="table-container" id="detalhada-adesoes-table-section" style="display: none;">
                        <h2>Adesões Detalhadas no Período</h2>
                        <table id="detalhada-adesoes-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Unidade</th>
                                    <th>Cód. Integrante</th>
                                    <th>Integrante</th>
                                    <th>Data Cadastro</th>
                                    <th>Cód. Fundo</th>
                                    <th>Tipo</th>
                                    <th>Consultor</th>
                                    <th>VVR</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>
                    <section class="table-container" id="fundos-detalhados-table-section" style="display: none;">
                        <h2>Fundos Detalhados no Período</h2>
                        <table id="fundos-detalhados-table" class="display" style="width:100%">
                            <thead>
                                <tr>
                                    <th>Unidade</th>
                                    <th>ID Fundo</th>
                                    <th>Fundo</th>
                                    <th>DT Contrato</th>
                                    <th>DT Cadastro</th>
                                    <th>Tipo de Serviço</th>
                                    <th>Instituição</th>
                                    <th>DT Baile</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="date-picker.js"></script>
    <script>
        $(document).ready(function() {
            // Função para liberar acesso
            $('#access-code-button').click(function() {
                const codigoDigitado = $('#access-code-input').val();
                
                if(codigoDigitado === '20250') {
                    // Esconde a tela de login
                    $('#login-overlay').fadeOut();
                    // Mostra o dashboard
                    $('.dashboard-wrapper').fadeIn();
                    
                    // Salva o estado de login
                    sessionStorage.setItem('dashboardLogado', 'true');
                } else {
                    $('#login-error-message').text('Código de acesso inválido!');
                }
            });

            // Verifica se já está logado
            const estaLogado = sessionStorage.getItem('dashboardLogado');
            if(estaLogado === 'true') {
                $('#login-overlay').hide();
                $('.dashboard-wrapper').show();
            }

            // Permite usar Enter para submeter o código
            $('#access-code-input').keypress(function(e) {
                if(e.which == 13) { // 13 é o código da tecla Enter
                    $('#access-code-button').click();
                }
            });
        });
    </script>
</body>
</html>