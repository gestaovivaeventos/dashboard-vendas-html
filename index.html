<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste de Busca - Google Sheet</title>
</head>
<body>
    <h1>Teste de Busca de Metas</h1>
    <p>Abra o console do navegador (Inspecionar -> Console) para ver o resultado.</p>
    <pre id="output" style="background-color:#eee; color:#333; padding:10px; border:1px solid #ccc; white-space: pre-wrap; word-wrap: break-word;"></pre>

    <script>
        // COLE A SUA URL GERADA NO PASSO 2 AQUI
        const METAS_URL = "COLE_A_URL_DO_CSV_AQUI";

        async function testFetch() {
            const outputElement = document.getElementById('output');
            console.log("Iniciando o teste de busca na Planilha...");
            outputElement.textContent = "Tentando buscar dados da Planilha...";

            try {
                const response = await fetch(METAS_URL);
                console.log("Resposta recebida da URL:", response);

                if (!response.ok) {
                    console.error("A resposta da rede não foi OK. Status:", response.status);
                    outputElement.textContent = `Erro! O servidor respondeu com o status: ${response.status}. Veja o console.`;
                    return;
                }

                const csvText = await response.text();
                
                // Verifica se o texto recebido é um HTML (página de login)
                if (csvText.trim().toLowerCase().startsWith("<!doctype html")) {
                    console.error("ERRO: O conteúdo recebido é uma página HTML, não um CSV. Verifique as permissões de compartilhamento da planilha.");
                    outputElement.textContent = "ERRO: A planilha retornou uma página HTML em vez de dados CSV. Garanta que o 'Acesso geral' da planilha está como 'Qualquer pessoa com o link'.";
                    return;
                }
                
                console.log("Texto CSV recebido (primeiros 500 caracteres):", csvText.substring(0, 500));
                outputElement.textContent = "SUCESSO! Os dados foram recebidos. Veja o conteúdo no console.\n\n" + csvText.substring(0, 500) + "...";

            } catch (error) {
                console.error("ERRO CRÍTICO DURANTE O FETCH:", error);
                outputElement.textContent = "ERRO CRÍTICO! Verifique o console para detalhes do erro de 'fetch'. Provavelmente é um problema de CORS ou de rede.";
            }
        }

        testFetch();
    </script>
</body>
</html>
